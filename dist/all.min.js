"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}!function(){function e(t,n,o){var r={};if("string"!=typeof n){for(var i in n)r[n[i]]=e(t,n[i],o);return r}var a=document.createElement("canvas");return a.id=a.className="krakout-canvas-"+n,o(a),a.getContext("2d")}function t(e){var t=parseFloat(window.getComputedStyle(e).width),n=parseFloat(window.getComputedStyle(e).height);return function(o){o.width=WIDTH,o.height=HEIGHT,o.style.position="absolute",o.style.top=0,o.style.left=0,o.style.width=WIDTH,o.style.height=HEIGHT,o.style.transform="scale3d("+t/WIDTH+", "+n/HEIGHT+", 1)",o.style.transformOrigin="top left",e.appendChild(o)}}var n=window.utils=window.utils||{};n.buildScreen=t,n.buildCanvas=e}();var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();window.config={},window.config.WIDTH=4096,window.config.HEIGHT=2160;var WIDTH=window.config.WIDTH,HEIGHT=window.config.HEIGHT,defaultConfig={},Krakout=function(){function e(t){function n(){r=o._canvas=utils.buildCanvas(t,["ball","board","layout"],utils.buildScreen(t));var e=new PlainBoard(r.board,{controller:o});t.addEventListener("mousemove",function(t){e.change({x:t.screenX/o.ratioWidth})});var n=new PlainBall(r.ball,{controller:o}),i=o.balls=[];i.push(n)}arguments.length<=1||void 0===arguments[1]?defaultConfig:arguments[1];_classCallCheck(this,e);var o=this,r=void 0,i=o.screenWidth=parseFloat(getComputedStyle(t).width),a=(o.ratioWidth=i/WIDTH,o.screenHeight=parseFloat(getComputedStyle(t).height));o.ratioHeight=a/HEIGHT;n()}return _createClass(e,[{key:"accessMove",value:function(e){var t=e.config.x,n=e.config.y;(0>=t||t+e.config.width>=WIDTH)&&(e.offsetX=~e.offsetX+1),(0>=n||n+e.config.width>=HEIGHT)&&(e.offsetY=~e.offsetY+1),e.change({x:t-e.offsetX,y:n-e.offsetY})}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),ModuleBase=function(){function e(t){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];_classCallCheck(this,e);var o=this;o.__willChange=[],o.ctx=t,o.config=n,n.x=n.x||0,n.y=n.y||0,o.regChange(["x","y","width","height"]),o.initReady(),o.reDraw(),o.initComplete()}return _createClass(e,[{key:"regChange",value:function(e){if(e)if("string"==typeof e)this.__willChange.push(e);else if(e.length)this.__willChange=this.__willChange.concat(e);else for(var t in e)this.regChange(item)}},{key:"change",value:function(e){var t=!1;for(var n in e)n in this.config&&this.__willChange.includes(n)&&(this.config[n]=e[n],t=!0);t&&this.reDraw()}},{key:"clear",value:function(){this.ctx.clearRect(0,0,window.config.WIDTH,window.config.HEIGHT)}},{key:"initReady",value:function(){}},{key:"beforeDraw",value:function(){this.clear()}},{key:"draw",value:function(){}},{key:"afterDraw",value:function(){}},{key:"initComplete",value:function(){}},{key:"reDraw",value:function(){this.beforeDraw(),this.draw(),this.afterDraw()}}]),e}(),Board=function(e){function t(e,n){return _classCallCheck(this,t),n.width=n.width||400,n.height=n.height||20,n.x=(window.config.WIDTH-n.width)/2,n.y=window.config.HEIGHT-n.height,_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,n))}return _inherits(t,e),t}(ModuleBase),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),Ball=function(e){function t(e,n){return _classCallCheck(this,t),n.width=n.width||20,n.x=(window.config.WIDTH-n.width)/2,n.y=window.config.HEIGHT-n.width-20,n.stride=30,_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,n))}return _inherits(t,e),_createClass(t,[{key:"fire",value:function(){this.offsetX=14*Math.random()|1,this.offsetY=this.config.stride-this.offsetX,this.proceed()}},{key:"proceed",value:function(){var e=this,t=function n(){e.config.controller.accessMove(e),e.moveFlag=requestAnimationFrame(n)};e.moveFlag=requestAnimationFrame(t)}},{key:"pause",value:function(){cancelAnimationFrame(this.moveFlag)}}]),t}(ModuleBase),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),PlainBoard=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"draw",value:function(){var e=this.ctx,t=this.config,n=new Path2D;n.rect(t.x,t.y,t.width,t.height),e.fill(n)}},{key:"initComplete",value:function(){}}]),t}(Board),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),PlainBall=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"draw",value:function(){var e=this.ctx,t=this.config,n=new Path2D;n.arc(t.x,t.y,t.width,0,2*Math.PI),e.fill(n)}},{key:"initComplete",value:function(){this.fire()}}]),t}(Ball);